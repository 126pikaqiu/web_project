<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
  <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
  <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
  <link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
  <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />

<title>添加好友</title>
</head>
<body>
<div class="page-container">
  <div id="serach-header">
    <input type="text" class="input-text" id="search-input" placeholder="请输入查找的用户昵称，enter搜索">
  </div>
  <div id="recommend-friends" style="margin: 20px 20px;">
    <strong>你可能认识</strong>
    <table class="table table-border table-bordered table-hover table-bg">
      <thead>
      <tr><td>用户名</td><td>个性签名</td><td>操作</td></tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div id="search-result">
    <strong>搜索结果</strong>
    <table class="table table-border table-bordered table-hover table-bg">
      <thead>
      <tr><td>用户名</td><td>个性签名</td><td>操作</td></tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
</div>
<script type="text/javascript" src="http://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript">
</script>
<script type="text/javascript">
  $(function () {
      getRecommendFriends();
  });
    /*用户-查看*/
    function member_show(title,url,id,w,h){
        layer_show(title,url + '?id=' + id,w,h);
    }
    function searchUsers() {
        let name = $("#search-input").val();
        if(name !== ''){
            $.ajax({
                url:'/users/login',
                data:{'username':name},
                type:'get',
                success:function (data) {
                    data = eval('(' + data + ')');
                    let r_html = '';

                    for(let i = 0; i < data.length; i++){

                        if(data[i]['pwd'] == '0' && data[i]['userID']!=localStorage.getItem("userID")){
                            r_html += '<tr><td><u style="cursor:pointer" class="text-primary" onclick=\'member_show("' + data[i]["name"] +'","member-show.html",' + data[i]['userID'] + ',"360","400")\'>' +
                                data[i]["name"] + '</u></td><td>' + (data[i]['signature'] || '很懒的TA什么也没留下') + '</td><td><a title="添加" ' +
                            'href="javascript:;" onclick="friend_add(' + data[i]['userID']+ ')" class="ml-5">添加为好友</a></td></tr>';
                        } else {
                            r_html += '<tr><td><u style="cursor:pointer" class="text-primary" onclick=\'member_show("' + data[i]["name"] +'","member-show.html",' + data[i]['userID'] + ',"360","400")\'>' +
                                data[i]["name"] + '</u></td><td>' + (data[i]['signature'] || '很懒的TA什么也没留下') + '</td><td><a title="nothing" ' +
                                'href="javascript:;" class="ml-5">已经为好友</a></td></tr>';
                        }
                    }
                    $("#search-result tbody").html(r_html);
                },
                error:function () {
                    console.log('搜索用户失败');
                }
            });

        }
    }
    function getRecommendFriends(){
        $.ajax({
            url:'/friends/recommends',
            data:{'userID':0,'want':'recommends'},
            type:'get',
            success:function (data) {
                data = eval('(' + data + ')');
                let r_html = '';
                let ids = [];
                for(let i = 0; i < data.length; i++){
                    if(ids.indexOf(data[i]['userID']) >= 0) {
                        continue;
                    }
                    r_html += '<tr><td><u style="cursor:pointer" class="text-primary" onclick=\'member_show("' + data[i]["name"] +'","member-show.html",' + data[i]['userID'] + ',"360","400")\'>' +
                        data[i]["name"] + '</u></td><td>' + (data[i]['signature'] || '很懒的TA什么也没留下') + '</td><td><a title="添加" ' +
                        'href="javascript:;" onclick="friend_add(' + data[i]['userID']+ ')" class="ml-5">添加为好友</a></td></tr>';
                    ids.push(data[i]['userID']);
                }
                $("#recommend-friends tbody").html(r_html);
            },
            error:function () {
                console.log('推荐用户失败');
            }
        });
    }

    $("#search-input").keypress(function (e) {
        if(e.keyCode===13){
            searchUsers();
        }
    });
    function friend_add(userID) {
        $.ajax({
            url:'/friends/request',
            type:'post',
            data:{'order':'add_request','userID':userID},
            success:function () {
                layer.msg('发送添加请求成功',{icon:1,time:1000});
            },
            error:function () {
                layer.msg('发送添加请求失败，请检查网络。',{icon:2,time:1000});
            }
        })
    }

</script>
</body>
</html>