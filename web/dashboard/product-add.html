<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />

<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->

</head>
<body>
<div class="page-container">
	<form action="/users/manage/items" method="post" class="form form-horizontal" id="form-article-add" enctype="multipart/form-data">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>艺术品标题：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="name" name="name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>年份：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="time" name="time">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>类型：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="genre" name="genre">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>馆址：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" name="location" id="location" placeholder="" value="" class="input-text">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>描述：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="description" id="description" cols="" rows="" class="textarea"  placeholder="说点什么描述一下艺术品吧..." datatype="*10-100" dragonfly="true" nullmsg="描述不能为空！"></textarea>
			</div>
		</div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red" id="upload-img-span">*</span>上传图片：</label>
            <div class="formControls col-xs-8 col-sm-9"> <span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="img" id="upload-img" readonly style="width:200px">
				<a href="javascript:void(0);" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" multiple name="imgFile" class="input-file">
				</span> </div>
        </div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red" id="upload-video-span">*</span>上传视频：</label>
			<div class="formControls col-xs-8 col-sm-9"> <span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="video" id="upload-video" readonly style="width:200px">
				<a href="javascript:void(0);" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" multiple name="videoFile" class="input-file">
				</span> </div>
		</div>
        <div class="row cl">
            <input type="hidden" name="hot" id="hot" placeholder="" value="" class="input-text">
			<input type="hidden" name="id" id="id" placeholder="" value="" class="input-text">
			<input type="hidden" name="operation" id="operation" placeholder="" value="" class="input-text">
        </div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
<!--				<button class="btn btn-primary radius" type="submit" id="article-submit"><i class="Hui-iconfont">&#xe632;</i> 保存并提交</button>-->
				<input id="btn-submit" class="btn btn-primary radius" type="button" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
				<button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">
$(function() {
    $('.skin-minimal input').iCheck({
        checkboxClass: 'icheckbox-blue',
        radioClass: 'iradio-blue',
        increaseArea: '20%'
    });
})
</script>
<script>
	$(document).ready(function () {
		let id = getUrlVars();
		if (id['id'] !== undefined){//修改
			$("#upload-img-span").html("");
			$("#upload-video-span").html("");
			$("#form-article-add").validate({
				rules: {
					name: {
						required: true,
						minlength: 2,
						maxlength: 16
					},
					time: {
						required: true,
						digits:true
					},
					location: {
						required: true,
					},
					description: {
						required: true,
					},
					genre: {
						required: true,
					},
				},
				onkeyup: false,
				focusCleanup: true,
				success: "valid",
				// submitHandler: function (form) {
				//
				// 	var index = parent.layer.getFrameIndex(window.name);
				// 	//parent.$('.btn-refresh').click();
				// 	parent.layer.close(index);
				// }
			});

			let itemJson = JSON.parse(localStorage.getItem("item-"+id['id']));
			console.log("itemjson:"+itemJson);
			console.log(itemJson);
			$("#name").val(itemJson['name']);
			$("#description").val(itemJson['description']);
			$("#time").val(itemJson['time']);
			$("#genre").val(itemJson['genre']);
			$("#location").val(itemJson['location']);
			$("#upload-img").val(itemJson['img']);
			$("#upload-video").val(itemJson['video']);
			$("#id").val(id['id']);
			$("#hot").val(itemJson['hot']);
			$("#operation").val("change");

		}else {//添加
			$("#form-article-add").validate({
				rules:{
					name:{
						required:true,
						minlength:2,
						maxlength:16
					},
					time:{
						required:true,
						digits:true
					},
					location:{
						required:true,
					},
					description:{
						required:true,
					},
					genre:{
						required:true,
					},
					img:{
						required:true,
					},
					video:{
						required:true,
					}
				},
				onkeyup:false,
				focusCleanup:true,
				success:"valid",
			});
			$("#hot").val("0");
			$("#operation").val("add");

		}
		$("#btn-submit").click(function () {
			let form = document.getElementById('form-article-add');
			let formData = new FormData(form);
			if( !$(form).validate()){
				console.log("表格不完整");
				return;
			}
			$.ajax({
				url:"/users/manage/items",
				type:"post",
				data:formData,
				processData:false,
				contentType:false,
				success:function(res){
					console.log("OK");
					layer.msg("上传成功",{icon: 1, time: 1000});
					setTimeout(function () {
						var index = parent.layer.getFrameIndex(window.name);
						//parent.$('.btn-refresh').click();
						parent.layer.close(index)
					},1000);
				},
				error:function(err){
					console.log("Fail");
					layer.msg("上传失败",{icon: 2, time: 1000})
				}

			});
		})

	});
	function getUrlVars(){
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?')+1).split('&');
		for(var i = 0; i < hashes.length; i++) {
			hash = hashes[i].split('=');
			vars.push(hash[0]);
			vars[hash[0]] = hash[1];
		}
		return vars;
	}
</script>
</body>
</html>