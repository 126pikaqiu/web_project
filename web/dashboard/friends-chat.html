<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link href="static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css" />

<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>空白页</title>
</head>
<body>
<script type="text/javascript">
    function sendMessage() {
        let userID = getUrlVars()['id'];
        let message = $("#chat-input").val();
        if(message !== ''){
            $("#chat-body tbody").html($("#chat-body tbody").html() +
                '<tr><td class="text-r c-primary">'+ message +'<strong>:我</strong></td></tr>');
            $.ajax({
                url:'/friends/message',
                type:'post',
                data:{'message':message,'order':'send_message','userID':userID},
                success:function () {
                    console.log('发送成功');
                },
                error:function () {
                    console.log('发送失败');
                }
            })
        }
        $('#chat-body-overflow').scrollTop($('#chat-body-overflow')[0].scrollHeight);
    }
</script>
<div class="pd-20">
  <div style="height: 400px;overflow: scroll" id="chat-body-overflow">
    <table class="table table-hover"  id="chat-body">
      <thead></thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div>
    <input type="text" id="chat-input" class="input-text" maxlength="150" placeholder="说点什么吧,enter发送">
  </div>
</div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript">
function getUrlVars(){
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?')+1).split('&');
    for(var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}
$(function(){
  let userID = getUrlVars()['id'];
  let name=decodeURI(getUrlVars()['name']);
  setInterval(function () {
      $.ajax({
          url:'/friends/message',
          data:{'userID':userID,'want':'messages'},
          type:'get',
          success:function (data) {
              data = eval('(' + data + ')');
              let r_html = '';
              for(let i = 0; i < data.length; i++){
                  if(data[i]['id2'] == userID){
                      r_html += '<tr><td class="text-r c-primary">'+ data[i]['message'] +'<strong>:我</strong></td></tr>'
                  } else{
                      r_html += '<tr><td class="text-l c-orange"><strong>'+name+':</strong>'+ data[i]['message'] +'</td></tr>';
                  }
              }
              $("#chat-body tbody").html(r_html);
              $('#chat-body-overflow').scrollTop($('#chat-body-overflow')[0].scrollHeight);
          },
          error:function () {
              console.log('加载聊天记录失败');
          }
      });
  },2000);
  $("#chat-input").keypress(function (e) {
      if(e.keyCode===13){
          sendMessage();
      }
  });


});
</script>
</body>
</html>